# Техническое Задание (ТЗ): Система Тегов (Tag System)

## 1. Общее описание

Необходимо разработать универсальную систему компонентов для работы с тегами (tags/chips) в админ-панели Aurora Admin. Система включает два основных standalone-компонента Angular 19:

- `av-tag` — базовый примитив для отображения отдельных тегов (статусы, категории, метки).
- `av-tag-input` — композитный компонент для ввода и управления списком тегов.

Компоненты должны полностью соответствовать дизайн-системе проекта (цвета, типографика, темизация), обеспечивать высокую доступность (accessibility), производительность (signals/reactivity) и интеграцию с существующими механизмами (toast-уведомления, формы, таблицы).

Все теги нормализуются: приводятся к нижнему регистру, проверяются на дубликаты, длину и допустимые символы. При нарушениях правил — тег не добавляется, выводится предупреждение.

## 2. Компонент: `av-tag` (Отображение тега)

### 2.1. Назначение

Базовый визуальный элемент для отображения меток, статусов, категорий и фильтров. Может быть статичным, кликабельным или удаляемым.

### 2.2. API (Inputs)

| Свойство    | Тип                                                                               | Default     | Описание                                                                            |
| ----------- | --------------------------------------------------------------------------------- | ----------- | ----------------------------------------------------------------------------------- |
| `label`     | `string`                                                                          | `''`        | Текст тега (обязателен, если не используется slot)                                  |
| `size`      | `'small' \| 'medium' \| 'large'`                                                  | `'medium'`  | Размер (влияет на padding, font-size и иконки)                                      |
| `variant`   | `'filled' \| 'outlined' \| 'soft'`                                                | `'soft'`    | Визуальный стиль (filled — сплошной фон, outlined — обводка, soft — полупрозрачный) |
| `color`     | `'primary' \| 'success' \| 'warning' \| 'error' \| 'info' \| 'neutral' \| string` | `'neutral'` | Предопределённая схема или кастомный HEX/RGB                                        |
| `shape`     | `'rounded' \| 'pill'`                                                             | `'rounded'` | Скругление углов (rounded — 8px, pill — полное)                                     |
| `removable` | `boolean`                                                                         | `false`     | Отображать кнопку закрытия (×)                                                      |
| `clickable` | `boolean`                                                                         | `false`     | Делать тег интерактивным (hover-эффект, pointer cursor)                             |
| `icon`      | `string \| null`                                                                  | `null`      | Имя иконки (из существующей системы иконок) для отображения слева                   |

### 2.3. Events (Outputs)

- `(clicked)` — эмитится при клике на тело тега (если `clickable=true`). Payload: `string` (label).
- `(removed)` — эмитится при клике на кнопку закрытия (если `removable=true`). Payload: `string` (label).

### 2.4. Дизайн и стили

- Высота: адаптивная под размер (small ~28px, medium ~32px, large ~40px).
- Типографика: шрифт Inter, размер text-xs (small), text-sm (medium), text-base (large).
- Иконки: размер 14–18px, цвет наследуется от текста.
- Темизация: полная поддержка light/dark mode (CSS variables).
- Transitions: opacity/color/background 0.2s ease.
- Accessibility:
  - При `removable=true` — кнопка закрытия с `aria-label="Удалить тег {{label}}"`.
  - При `clickable=true` — role="button", tabindex="0".

## 3. Компонент: `av-tag-input` (Ввод тегов)

### 3.1. Назначение

Компонент поля ввода для создания и управления множественным списком тегов. Введённые теги отображаются как `av-tag` внутри поля.

### 3.2. Основная функциональность

1. **Добавление тега**:

   - Ввод текста → нажатие Enter, запятой (,) или потеря фокуса (blur) → создание тега.
   - Автоматическая нормализация: trim(), toLowerCase().
   - Валидация перед добавлением (дубликаты, длина, паттерн).
   - Если валидация не пройдена — тег не добавляется, показывается toast-предупреждение.

2. **Удаление тега**:

   - Клик на × в теге.
   - Backspace в пустом поле ввода — удаляет последний тег.
   - Delete при выделении тега (опционально).

3. **Предупреждения**:

   - Дубликат: "Тег '{{value}}' уже существует".
   - Длина: "Длина тега должна быть от {{min}} до {{max}} символов".
   - Паттерн: "Тег содержит недопустимые символы".

4. **Дополнительно**:
   - Автоматическая сортировка тегов по алфавиту после добавления/удаления.
   - Поддержка автодополнения (suggestions).

### 3.3. API (Inputs)

| Свойство               | Тип              | Default            | Описание                                                 |
| ---------------------- | ---------------- | ------------------ | -------------------------------------------------------- |
| `tags`                 | `string[]`       | `[]`               | Двусторонняя модель (v-model)                            |
| `placeholder`          | `string`         | `'Введите тег...'` | Placeholder поля ввода                                   |
| `addOnKeys`            | `string[]`       | `['Enter', ',']`   | Клавиши создания тега                                    |
| `allowDuplicates`      | `boolean`        | `false`            | Разрешать дубликаты                                      |
| `maxTags`              | `number \| null` | `null`             | Максимальное количество тегов                            |
| `minLength`            | `number`         | `1`                | Минимальная длина тега                                   |
| `maxLength`            | `number`         | `30`               | Максимальная длина тега                                  |
| `allowedPattern`       | `RegExp \| null` | `/^[a-z0-9-]+$/i`  | Регулярное выражение (по умолчанию: буквы, цифры, дефис) |
| `normalizeCase`        | `boolean`        | `true`             | Приводить к нижнему регистру                             |
| `autoSort`             | `boolean`        | `true`             | Автоматическая сортировка по алфавиту                    |
| `suggestions`          | `string[]`       | `[]`               | Массив подсказок для автодополнения                      |
| `showDuplicateWarning` | `boolean`        | `true`             | Показывать toast при попытке добавить дубликат           |
| `variant`              | `same as av-tag` | `'soft'`           | Стиль отображаемых тегов                                 |
| `disabled`             | `boolean`        | `false`            | Блокировка компонента                                    |

### 3.4. Events (Outputs)

- `(tagsChange)` — эмитится при любом изменении массива тегов. Payload: `string[]`.
- `(invalidTagAttempted)` — эмитится при неудачной попытке добавления. Payload: `{ value: string; reason: 'duplicate' | 'length' | 'pattern' | 'maxTags' }`.
- `(inputBlur)` — потеря фокуса компонентом.

### 3.5. Дизайн и стили

- Общий контейнер: flex-wrap, border как у стандартного input (высота 42px).
- Теги внутри: margin-right/margin-bottom для обтекания.
- Поле ввода: растягивается на оставшееся место (flex: 1).
- При ошибке валидации: кратковременная красная обводка поля.
- Accessibility:
  - role="textbox" + aria-multiselectable="true".
  - Клавиатурная навигация: стрелки для выделения тегов, Backspace/Delete для удаления.

## 4. Технические требования

- Angular 19, standalone components, signals для состояния.
- Использование существующих примитивов (av-input стили, av-icon, av-toast).
- Полная реактивность: изменения tags сразу отражаются в UI.
- Поддержка OnPush change detection.
- Тестирование: unit-тесты на валидацию, добавление/удаление, клавиатурные события.

## 5. План реализации

1. **Дизайн-токены** — определить CSS variables для всех variant/color в светлой/тёмной теме.
2. **av-tag** — базовый компонент с полной поддержкой API.
3. **av-tag-input** — логика валидации, нормализации, toast-интеграция, автодополнение (dropdown при вводе).
4. **Demo-страница** — ui-demo/tags с примерами:
   - Статические теги (статусы заказов).
   - Интерактивный ввод с валидацией.
   - Фильтры таблицы с тегами.

## 6. Примеры использования

```html
<!-- Статический тег -->
<av-tag label="active" color="success" variant="soft" size="medium"></av-tag>

<!-- Удаляемый тег -->
<av-tag *ngFor="let tag of selectedTags" [label]="tag" removable="true" (removed)="removeTag(tag)">
</av-tag>

<!-- Поле ввода тегов -->
<av-tag-input
  [(tags)]="articleTags"
  placeholder="Добавьте теги статьи..."
  [maxTags]="10"
  [suggestions]="commonTags"
  (tagsChange)="saveTags($event)"
  (invalidTagAttempted)="handleInvalid($event)"
>
</av-tag-input>
```

Данное ТЗ является окончательным и готовым к реализации. Компоненты обеспечивают предсказуемое поведение, строгую валидацию и отличный пользовательский опыт в соответствии с требованиями проекта.
